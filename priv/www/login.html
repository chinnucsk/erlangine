<div><label for=loginName>Login</label></div>
<div><input id=loginName type=text /></div>
<div><label for=loginPassword>Password</label></div>
<div><input id=loginPassword type=password /></div>
<div class=centerWrapper>
    <a id=loginButton class=gbutton>Login</a>
    <a id=openRegister class=button>Register now!</a>
</div>
<!--a class=button href=# onclick="this.blur();"><span>Register now!</span></a-->

<script>
function logIn(){
    var json = {
	    "module": "login",
	    "action": "login",
	    "data": {
		"uid": $('loginName').value,
		"password": $('loginPassword').value
	    }
    }
    ajax(json, "/enge");
};

function logInFromPassw(ev){
    if(ev.key().code==13) logIn();
}

function openRegister(){
    $('regCaptchaImg').innerHTML = '';
    hideElement('loginContainer');
    showElement('registerContainer');
    var json = {
	"module": "register",
	"action": "captcha"
    }
    ajax(json, "/enge");
};

function cbLoggedIn(json){
    $('loginPassword').value = "";
    $('loggedUid').innerHTML = "<a>" + $('loginName').value + "</a>";
    showElement('loggedContainer');
    hideElement('welcomePage');
    showElement('mainDesk');
}

function cbNotLoggedIn(json){
    alert(JSON.stringify(json));
}

connect('loginButton', 'onclick', logIn);
connect('loginPassword', 'onkeydown', logInFromPassw);
connect('openRegister', 'onclick', openRegister);

connect(xapi, 'login:login-ok', cbLoggedIn);
connect(xapi, 'login:login-fail', cbNotLoggedIn);
</script>
